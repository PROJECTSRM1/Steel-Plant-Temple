<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Ayyappa Swamy Temple - Puja Calendar</title>
<link rel="stylesheet" href="MonthCalendar.css" />
</head>
<body>

  <div>
    <h2>ðŸª” Ayyappa Swamy Temple Puja Calendar</h2>

    <div class="main-container">
      <!-- Left side -->
      <div class="calendar-container">
        <div class="calendar" id="calendar"></div>
        <button class="below-calendar-btn" id="updateScheduleBtn">Update Schedule</button>
        <div id="monthEvents" class="month-events"></div>

      </div>

      <!-- Right side -->
      <div class="right-panel">
        <div id="eventDisplay"></div>
        <button class="action-btn" id="addEventBtn">Add Event</button>
        <button class="action-btn" id="editEventBtn">Edit Event</button>
      </div>
    </div>
  </div>

  <!-- Popup -->
  <div class="overlay" id="overlay"></div>
  <div class="popup" id="popup">
    <h3 id="popupTitle">Temple Staff Login</h3>
    <div id="loginSection">
      <input type="password" id="staffPass" placeholder="Enter password" />
      <button onclick="login()">Login</button>
      <p id="loginMsg" style="color: red;"></p>
    </div>

    <div id="eventSection" style="display:none;">
      <input type="text" id="eventTitle" placeholder="Event Title" />
      <textarea id="eventDesc" placeholder="Event Description"></textarea>
      <button id="saveEventBtn">Save Event</button>
    </div>
  </div>

<script>
const calendar = document.getElementById("calendar");
const today = new Date();
const currentMonth = today.getMonth();
const currentYear = today.getFullYear();

const updateScheduleBtn = document.getElementById("updateScheduleBtn");
const addEventBtn = document.getElementById("addEventBtn");
const editEventBtn = document.getElementById("editEventBtn");
const popup = document.getElementById("popup");
const overlay = document.getElementById("overlay");
const eventSection = document.getElementById("eventSection");
const eventDisplay = document.getElementById("eventDisplay");

let selectedDate = null;
let isStaff = false;
let events = JSON.parse(localStorage.getItem("templeEvents")) || {};
let editMode = false;

// Generate current month calendar
const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
for (let d = 1; d <= daysInMonth; d++) {
  const dayDiv = document.createElement("div");
  dayDiv.classList.add("day");
  dayDiv.textContent = d;

  const dateObj = new Date(currentYear, currentMonth, d);

  if (dateObj < new Date(today.getFullYear(), today.getMonth(), today.getDate())) {
    dayDiv.style.background = "#eee";
    dayDiv.style.cursor = "not-allowed";
  } else {
    dayDiv.addEventListener("click", () => {
      document.querySelectorAll(".day").forEach(el => el.classList.remove("selected"));
      dayDiv.classList.add("selected");
      selectedDate = `${d}-${currentMonth + 1}-${currentYear}`;
      updateScheduleBtn.style.display = "inline-block";
      showEventsForDate(selectedDate);
    });
  }

  if (d === today.getDate()) dayDiv.classList.add("today");
  calendar.appendChild(dayDiv);
}

// Show login popup on clicking Update Schedule
updateScheduleBtn.addEventListener("click", () => {
  popup.style.display = "block";
  overlay.style.display = "block";
  document.getElementById("loginSection").style.display = "block";
  eventSection.style.display = "none";
  document.getElementById("popupTitle").textContent = "Temple Staff Login";
});

overlay.addEventListener("click", closePopup);

function closePopup() {
  popup.style.display = "none";
  overlay.style.display = "none";
}

// Staff Login
function login() {
  const pass = document.getElementById("staffPass").value;
  if (pass === "ayyappa123") {
    isStaff = true;
    closePopup();
    addEventBtn.style.display = "inline-block";
    editEventBtn.style.display = "inline-block";
    updateScheduleBtn.style.display = "none";
    showEventsForDate(selectedDate);
    showMonthlyEvents();
  } else {
    document.getElementById("loginMsg").textContent = "Invalid password!";
  }
}

// Add Event
addEventBtn.addEventListener("click", () => {
  if (!selectedDate) return alert("Select a date first!");
  editMode = false;
  popup.style.display = "block";
  overlay.style.display = "block";
  document.getElementById("popupTitle").textContent = `Add Event - ${selectedDate}`;
  document.getElementById("loginSection").style.display = "none";
  eventSection.style.display = "block";
  document.getElementById("eventTitle").value = "";
  document.getElementById("eventDesc").value = "";
});

// Edit Event
editEventBtn.addEventListener("click", () => {
  if (!selectedDate) return alert("Select a date first!");
  if (!events[selectedDate]) return alert("No event found on this date!");
  editMode = true;
  popup.style.display = "block";
  overlay.style.display = "block";
  document.getElementById("popupTitle").textContent = `Edit Event - ${selectedDate}`;
  document.getElementById("loginSection").style.display = "none";
  eventSection.style.display = "block";
  document.getElementById("eventTitle").value = events[selectedDate].title;
  document.getElementById("eventDesc").value = events[selectedDate].desc;
});

// Save Event
document.getElementById("saveEventBtn").addEventListener("click", () => {
  const title = document.getElementById("eventTitle").value.trim();
  const desc = document.getElementById("eventDesc").value.trim();
  if (!title) return alert("Enter event title!");

  events[selectedDate] = { title, desc };
  localStorage.setItem("templeEvents", JSON.stringify(events));

  closePopup();
  showEventsForDate(selectedDate);
  showMonthlyEvents();
});

// Delete Event
function deleteEvent(date) {
  if (confirm(`Are you sure you want to delete the event on ${date}?`)) {
    delete events[date];
    localStorage.setItem("templeEvents", JSON.stringify(events));
    showEventsForDate(selectedDate);
    showAllEvents(); // refresh full list after deleting
  }
}

// Show events for selected date
function showEventsForDate(date) {
  eventDisplay.innerHTML = "";
  const matchingEvents = Object.entries(events).filter(([key]) => key === date);

  if (matchingEvents.length > 0) {
    matchingEvents.forEach(([dateStr, ev]) => {
      const div = document.createElement("div");
      div.classList.add("event-card");
      div.innerHTML = `
        <h4>${ev.title}</h4>
        <p><strong>Date:</strong> ${dateStr}</p>
        <p>${ev.desc}</p>
        ${isStaff ? `<button class='delete-btn' style='display:inline-block;' onclick="deleteEvent('${dateStr}')">Delete</button>` : ""}
      `;
      eventDisplay.appendChild(div);
    });
  } else {
    eventDisplay.innerHTML = "<p style='color:#777;'>No event scheduled for this date.</p>";
  }
}

// Show all events (for all months)
function showAllEvents() {
  const monthEventsDiv = document.getElementById("monthEvents");
  monthEventsDiv.innerHTML = "<h3>ðŸª” All Scheduled Temple Events</h3>";

  const allEventKeys = Object.keys(events);
  if (allEventKeys.length === 0) {
    monthEventsDiv.innerHTML += "<p style='color:#777;'>No events scheduled yet.</p>";
    return;
  }

  // Sort events by date (day, month, year)
  allEventKeys.sort((a, b) => {
    const [da, ma, ya] = a.split("-").map(Number);
    const [db, mb, yb] = b.split("-").map(Number);
    return new Date(ya, ma - 1, da) - new Date(yb, mb - 1, db);
  });

  allEventKeys.forEach(dateStr => {
    const ev = events[dateStr];
    const card = document.createElement("div");
    card.classList.add("event-card");
    card.innerHTML = `
      <h4>${ev.title}</h4>
      <p><strong>Date:</strong> ${dateStr}</p>
      <p>${ev.desc}</p>
      ${isStaff ? `<button class='delete-btn' style='display:inline-block;' onclick="deleteEvent('${dateStr}')">Delete</button>` : ""}
    `;
    monthEventsDiv.appendChild(card);
  });
}

// refresh events on date click
document.querySelectorAll(".day").forEach(day => {
  day.addEventListener("click", () => {
    showEventsForDate(selectedDate);
    showAllEvents(); // ðŸ‘ˆ show all events below
  });
});

// Run once when page loads
showAllEvents();


</script>
</body>
</html>
